# ScriptToFrame 前端页面布局与功能理解

## 页面整体架构

### 主页面布局结构 (pages/index.js:11)
ScriptToFrame 采用**三栏式响应布局**，充分利用屏幕空间：

```
┌─────────────────────────────────────────────────────────────────────┐
│                        HEADER (头部导航)                            │
│  SCRIPTOFRAME | AI驱动的未来分镜生成平台 | 系统状态 | 版本信息        │
├─────────────────────────────────────────────────────────────────────┤
│                       PROGRESS BARS (进度条区域)                     │
│  [AI智能分析进度] [第一张图生成进度] [批量生成进度]                    │
├─────────────────┬─────────────────┬─────────────────────────────────┤
│   LEFT 30%      │   CENTER 15%    │           RIGHT 55%             │
│                 │                 │                                 │
│   剧本输入区     │    控制中心     │         分镜画板                │
│                 │                 │                                 │
│ • 大文本框       │ • 参数配置      │ • 卡片式分镜展示                │
│ • 格式验证       │ • 操作按钮      │ • 图片预览                     │
│ • 字数统计       │ • 状态显示      │ • 操作控制                     │
│ • 使用说明       │ • 操作指南      │ • 批量下载                     │
│                 │                 │                                 │
└─────────────────┴─────────────────┴─────────────────────────────────┘
│                        FOOTER (底部状态栏)                           │
│  © 2025 ScriptToFrame | AI分镜生成技术 | 系统就绪                     │
└─────────────────────────────────────────────────────────────────────┘
```

## 详细功能模块分析

### 1. 剧本输入区 (ScriptInput.jsx) - 左栏 30%

#### 核心功能特性
```javascript
// 实时验证逻辑 (ScriptInput.jsx:12-42)
const handleChange = (e) => {
  const newValue = e.target.value;
  const words = newValue.trim().split(/\s+/).filter(word => word.length > 0);
  setWordCount(words.length);  // 实时字数统计

  // 基础格式验证
  const minLength = newValue.length > 20;
  const hasContent = newValue.trim().length > 0;
}
```

#### 功能组件
- **📝 大文本框** - 最小高度500px，支持多行输入
- **🔍 格式验证** - 最少20字符，实时验证反馈
- **📊 字数统计** - 动态显示输入字数
- **🟢 状态指示器** - 绿色✓(有效) / 黄色⚠(无效)
- **📖 使用说明** - 支持多种剧本格式指导

#### 支持的剧本格式
```
✓ 标准剧本格式    ✓ 小说段落形式
✓ 对话型剧本      ✓ 场景描述型
✓ 混合格式        ✓ 自由文本
```

### 2. 控制中心 (ControlPanel.jsx) - 中栏 15%

#### 参数配置系统
```javascript
// 配置状态管理 (ControlPanel.jsx:19-24)
const [frameCount, setFrameCount] = useState(5);      // 剧场数量 3-12
const [style, setStyle] = useState('default');       // 画风风格
const [genre, setGenre] = useState('general');       // 漫剧类型
const [resolution, setResolution] = useState('2k');  // 图片分辨率
const [language, setLanguage] = useState('zh');      // 语言设置
const [aspectRatio, setAspectRatio] = useState('16:9'); // 图片比例
```

#### 配置选项详解

**🎬 剧场数量控制**
- **滑动条组件**: 3-12帧可调节
- **显示格式**: `剧场数量: 5 (生成6帧)`
- **实时预览**: 拖动立即显示数量变化

**🎨 画风选择 (7种风格)**
```
default   → 默认风格        anime     → 日漫风格
manga     → 国漫风格        korean    → 韩漫风格
3d        → 3D风格          chibi     → Q版风格
realistic → 写实风格
```

**📚 漫剧类型 (10种类型)**
```
general   → 通用            xuanhuan   → 玄幻修仙
urban     → 都市逆袭/战神   system     → 系统流/穿越
apocalypse → 末日/规则怪谈  romance    → 霸总甜宠
ancient   → 古风宫斗        rebirth    → 穿书/重生
comedy    → 搞笑沙雕        suspense   → 悬疑惊悚
```

**🖥️ 分辨率选择**
```
1K → 1024x576     2K → 2048x1152     4K → 4096x2304
```

**🌍 语言设置**
```
zh → 中文         en → English       ja → 日本語
```

**📐 图片比例**
```
16:9 → 横屏(标准)   1:1 → 方形        9:16 → 竖屏
```

#### 操作按钮系统
```javascript
// 动态按钮切换逻辑 (ControlPanel.jsx:221-244)
{isAnalyzing ? (
  <button onClick={onStopAnalysis} className="cyber-button cyber-button-warning">
    <span>⏹️</span><span>停止分析</span>
  </button>
) : (
  <button onClick={handleAnalyze} className="cyber-button cyber-button-primary">
    <span>🧠</span><span>AI智能分析</span>
  </button>
)}
```

**🧠 AI智能分析按钮**
- **正常状态**: `🧠 AI智能分析` (蓝色primary)
- **执行中**: `⏹️ 停止分析` (黄色warning)
- **功能**: 执行4步AI工作流，生成分镜数据

**🎬 生成第一张图按钮**
- **正常状态**: `🎬 生成第一张图` (绿色success)
- **执行中**: `⏹️ 停止生成` (黄色warning)
- **依赖**: 需要先完成AI智能分析

**🚀 生成所有分镜按钮**
- **正常状态**: `🚀 生成所有分镜` (红色danger)
- **执行中**: `⏹️ 停止生成` (黄色warning)
- **功能**: 批量生成所有分镜图片

### 3. 分镜画板 (StoryboardDisplay.jsx) - 右栏 55%

#### 卡片式分镜展示
```javascript
// 分镜卡片结构 (StoryboardDisplay.jsx:94-283)
frames.map((frame, index) => (
  <div key={frame.id} className="cyber-card relative">
    {/* 序号标识 */}
    <div className="absolute -left-3 -top-3 w-8 h-8 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold text-sm font-['Orbitron'] z-10 border-2 border-gray-900">
      {index + 1}
    </div>
    {/* 卡片内容 */}
  </div>
))
```

#### 分镜卡片组件详解

**🎯 卡片头部 (Header)**
- **标题格式**: `FRAME 01`, `FRAME 02`... (序号补零)
- **场景信息**: 显示场景描述或"未定义场景"
- **操作按钮**: ⬇️下载 + 🔁重新生成

**🖼️ 图片显示区 (16:9比例)**
- **待渲染状态**: 灰色占位图 + "待渲染"文字
- **生成中状态**: 模糊背景 + 🔄加载动画 + "AI绘制中..."
- **完成状态**: 图片显示 + 悬停放大效果 + "点击放大"提示
- **错误状态**: ⚠️警告图标 + 错误信息显示
- **状态指示器**: 🟡生成中 / 🟢已完成 / 🔴错误 / 🔵待渲染

**📋 信息展示区域**

1. **中文描述面板** (青色边框)
   ```
   📋 中文描述 [帧类型标签]
   显示: frame.displayDescription || frame.chineseDescription
   ```

2. **即梦提示词面板** (紫色边框)
   ```
   🤖 即梦提示词
   代码格式显示: frame.prompt || frame.jimengPrompt
   滚动查看长提示词
   ```

3. **元数据网格** (2x2网格)
   ```
   🎬 场次        🎞️ 类型
   第X场         标准帧/特殊类型

   📹 镜头        😊 情绪
   标准镜头       中性/其他情绪
   ```

4. **AI PROMPT面板** (灰色代码块)
   ```
   🤖 AI PROMPT
   技术提示词完整展示 (等宽字体)
   ```

#### 批量操作功能

**📦 批量下载按钮**
- **位置**: 分镜画板头部右侧
- **功能**: 下载所有已生成的图片
- **限制**: 生成中时禁用

**🔍 图片预览模态框**
```javascript
// 模态框预览 (StoryboardDisplay.jsx:297-336)
{selectedFrame && (
  <div className="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50">
    <div className="max-w-6xl max-h-full p-6 relative">
      {/* 科技风格装饰框 */}
      <img src={selectedFrame.imageUrl} className="max-w-full max-h-[80vh] object-contain" />
      {/* 图片信息叠层 */}
    </div>
  </div>
)}
```

### 4. 进度条系统 (ProgressBar.js)

#### 三种专用进度条
```javascript
// 进度条配置 (pages/index.js:767-797)
{/* AI智能分析进度条 */}
<ProgressBar
  progress={analysisProgress}
  title="AI智能分析"
  subtitle="正在执行4步工作流：故事切分 → 关键帧提取 → 提示词生成 → 结果整合"
  variant="primary"      // 蓝色主题
/>

{/* 第一张图生成进度条 */}
<ProgressBar
  progress={firstFrameProgress}
  title="生成第一张图"
  subtitle="准备数据 → 调用AI生成 → 处理结果"
  variant="success"      // 绿色主题
/>

{/* 批量生成进度条 */}
<ProgressBar
  progress={batchProgress}
  title="批量生成分镜图"
  subtitle="逐个生成所有分镜图片，请耐心等待..."
  variant="info"         // 紫色主题
/>
```

#### 进度条视觉特效
- **🌈 渐变色彩**: 根据variant显示不同颜色主题
- **✨ 流动光效**: 进度条内部流动动画
- **💫 脉冲效果**: 背景呼吸灯效果
- **📈 百分比显示**: 实时数值反馈
- **🔴 加载点动画**: 进行中时的点状动画
- **✅ 完成状态**: 100%时显示勾选图标

## 核心交互工作流程

### 完整使用流程
```
1. 📝 剧本输入
   ├─ 输入剧本文字 (>20字符)
   ├─ 实时格式验证 + 字数统计
   └─ 状态指示器显示 ✓

2. ⚙️ 参数配置
   ├─ 设置剧场数量 (3-12)
   ├─ 选择画风风格 (7种选项)
   ├─ 选择漫剧类型 (10种类型)
   ├─ 配置分辨率 (1K/2K/4K)
   └─ 设置语言比例

3. 🧠 AI智能分析
   ├─ 点击"AI智能分析"按钮
   ├─ 显示蓝色进度条 (4步工作流)
   ├─ 可随时点击"停止分析"中断
   └─ 完成后生成分镜卡片结构

4. 🎬 首图预览
   ├─ 点击"生成第一张图"按钮
   ├─ 显示绿色进度条 (3步生成)
   ├─ 第一张分镜卡片显示生成状态
   └─ 完成后可预览效果确认风格

5. 🚀 批量生成
   ├─ 点击"生成所有分镜"按钮
   ├─ 显示紫色进度条 (批量进度)
   ├─ 所有卡片逐个显示生成过程
   └─ 完成后可下载/重新生成

6. 📥 结果管理
   ├─ 单张下载: 点击卡片⬇️按钮
   ├─ 批量下载: 点击头部📦按钮
   ├─ 重新生成: 点击卡片🔁按钮
   └─ 图片预览: 点击图片放大查看
```

### 状态管理机制
```javascript
// 主要状态变量 (pages/index.js:14-37)
const [script, setScript] = useState('');           // 剧本内容
const [analysisResult, setAnalysisResult] = useState(null);  // AI分析结果
const [frames, setFrames] = useState([]);           // 分镜帧数据
const [isAnalyzing, setIsAnalyzing] = useState(false);       // 分析状态
const [isGeneratingFirst, setIsGeneratingFirst] = useState(false);   // 首图生成状态
const [isGeneratingAll, setIsGeneratingAll] = useState(false);       // 批量生成状态

// 停止控制器 (支持中断操作)
const [analysisController, setAnalysisController] = useState(null);
const [firstFrameController, setFirstFrameController] = useState(null);
const [allFramesController, setAllFramesController] = useState(null);

// 进度状态
const [analysisProgress, setAnalysisProgress] = useState(0);
const [firstFrameProgress, setFirstFrameProgress] = useState(0);
const [batchProgress, setBatchProgress] = useState(0);
```

## 技术实现特色

### 🎨 未来科技风格设计
- **霓虹色彩主题**: 青色(cyan)/紫色(purple)/蓝色(blue)渐变
- **科技边框效果**: `cyber-panel`, `cyber-card`, `cyber-button`样式类
- **字体搭配**: Orbitron(标题) + Rajdhani(正文) + 等宽字体(代码)
- **动画效果**: 脉冲/流动/渐变动画增强科技感

### 🔄 实时状态响应
- **按钮状态切换**: 正常/执行中/停止按钮动态切换
- **进度条联动**: 操作进度实时反馈到顶部进度条
- **卡片状态同步**: 生成状态实时同步到分镜卡片
- **中断控制支持**: 所有长时间操作都支持用户中断

### 📱 响应式布局适配
- **弹性比例**: 30%-15%-55%比例在不同屏幕下自适应
- **滚动区域**: 各区域独立滚动，避免布局冲突
- **模态框适配**: 图片预览模态框响应不同屏幕尺寸

### 🚀 用户体验优化
- **操作指导**: 每个区域都有详细使用说明
- **状态指示**: 多层次的状态反馈(指示器/进度条/文字)
- **错误处理**: 友好的错误信息显示和重试机制
- **批量操作**: 支持批量下载和批量生成提高效率

---

**文档版本**: v1.0.0
**最后更新**: 2025-12-25
**对应代码**: pages/index.js, components/*.jsx
**维护者**: ScriptToFrame Team